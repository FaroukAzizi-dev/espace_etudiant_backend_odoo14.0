<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <!-- Vue formulaire Matière -->
    <record id="view_matiere_form" model="ir.ui.view">
        <field name="name">student.matiere.form</field>
        <field name="model">student.matiere</field>
        <field name="arch" type="xml">
            <form string="Matière">
                <sheet>
                    <group>
                        <field name="name" required="1" />
                        <field name="code" required="1" />
                        <field name="description" />
                    </group>
                    <group>
                        <field name="semestre" required="1" />
                        <field name="volume_horaire" />
                        <field name="coefficient" required="1" />
                    </group>
                    <group>
                        <field name="classe_id" required="1" />
                    </group>
                    <group string="Enseignants">
                        <field name="enseignant_ids" widget="many2many_tags"
                            required="1"
                            options="{'color_field': 'color', 'no_create': True}"
                            help="Sélectionnez tous les enseignants qui vont enseigner cette matière" />
                        <field name="enseignant_id"
                            domain="[('id', 'in', enseignant_ids)]"
                            help="Enseignant principal (automatiquement défini)" />
                    </group>
                    <group>
                        <field name="active" />
                    </group>
                    <group>
                        <field name="evaluation_type_ids">
                            <tree editable="bottom">
                                <field name="type" />
                                <field name="pourcentage" />
                            </tree>
                        </field>

                    </group>

                </sheet>
            </form>
        </field>
    </record>

    <!-- Vue liste Matières -->
    <record id="view_matiere_tree" model="ir.ui.view">
        <field name="name">student.matiere.tree</field>
        <field name="model">student.matiere</field>
        <field name="arch" type="xml">
            <tree string="Matières">
                <field name="name" />
                <field name="code" />
                <field name="semestre" />
                <field name="volume_horaire" />
                <field name="coefficient" />
                <field name="evaluation_summary" string="Évaluations" />
                <field name="enseignant_ids" widget="many2many_tags" />
                <field name="enseignant_id" />
                <field name="classe_id" />
                <field name="active" />
            </tree>
        </field>
    </record>

    <!-- Vue Kanban Matières -->
    <record id="view_matiere_kanban" model="ir.ui.view">
        <field name="name">student.matiere.kanban</field>
        <field name="model">student.matiere</field>
        <field name="arch" type="xml">
            <kanban>
                <field name="name" />
                <field name="code" />
                <field name="semestre" />
                <field name="coefficient" />
                <field name="enseignant_ids" />
                <field name="classe_id" />
                <templates>
                    <t t-name="kanban-box">
                        <div class="oe_kanban_card">
                            <div class="oe_kanban_content">
                                <div class="oe_kanban_details">
                                    <strong class="o_kanban_record_title">
                                        <field name="name" />
                                    </strong>
                                    <div class="o_kanban_record_subtitle">
                                        <field name="code" /> - <field name="semestre" />
                                    </div>
                                    <div class="o_kanban_record_body">
                                        <div>Coefficient: <field name="coefficient" /></div>
                                        <div>Classe: <field name="classe_id" /></div>
                                        <div class="mt8">
                                            <strong>Enseignants:</strong>
                                            <field name="enseignant_ids" widget="many2many_tags" />
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>

    </record>


    <!-- Vue recherche Matières -->
    <record id="view_matiere_search" model="ir.ui.view">
        <field name="name">student.matiere.search</field>
        <field name="model">student.matiere</field>
        <field name="arch" type="xml">
            <search string="Rechercher Matières">
                <field name="name" string="Nom" />
                <field name="code" string="Code" />
                <field name="enseignant_ids" string="Enseignants" />
                <field name="classe_id" string="Classe" />

                <filter string="Semestre 1" name="semestre_1" domain="[('semestre', '=', '1')]" />
                <filter string="Semestre 2" name="semestre_2" domain="[('semestre', '=', '2')]" />
                <separator />
                <filter string="Actif" name="active" domain="[('active', '=', True)]" />
                <filter string="Inactif" name="inactive" domain="[('active', '=', False)]" />

                <group expand="0" string="Grouper par">
                    <filter string="Semestre" name="group_by_semestre"
                        context="{'group_by': 'semestre'}" />
                    <filter string="Classe" name="group_by_classe"
                        context="{'group_by': 'classe_id'}" />
                    <filter string="Enseignant principal" name="group_by_enseignant"
                        context="{'group_by': 'enseignant_id'}" />
                </group>
            </search>
        </field>
    </record>

    <!-- Action fenêtre Matières -->
    <record id="action_student_matiere" model="ir.actions.act_window">
        <field name="name">Matières</field>
        <field name="res_model">student.matiere</field>
        <field name="view_mode">tree,kanban,form,graph</field>
        <field name="view_id" ref="view_matiere_tree" />
        <field name="search_view_id" ref="view_matiere_search" />
        <field name="context">{}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Créez votre première matière !
            </p>
            <p>
                Ajoutez les matières enseignées dans votre établissement.
                Vous pouvez assigner plusieurs enseignants à chaque matière.
            </p>
        </field>
    </record>
</odoo>